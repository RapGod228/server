CHECK_INCLUDE_FILES(lzma.h HAVE_LZMA_H)
CHECK_LIBRARY_EXISTS(lzma lzma_stream_buffer_decode "" HAVE_LZMA_DECODE)
CHECK_LIBRARY_EXISTS(lzma lzma_easy_buffer_encode "" HAVE_LZMA_ENCODE)

IF (HAVE_LZMA_DECODE AND HAVE_LZMA_ENCODE AND HAVE_LZMA_H)
  MYSQL_ADD_PLUGIN(lzma_plugin lzma.c MODULE_OUTPUT_NAME lzma
    COMPONENT lzma LINK_LIBRARIES lzma)

  GET_PROPERTY(dirs TARGET lzma_plugin PROPERTY INCLUDE_DIRECTORIES)
  LIST(REMOVE_ITEM dirs ${CMAKE_SOURCE_DIR}/include/compression)
  SET_PROPERTY(TARGET lzma_plugin PROPERTY INCLUDE_DIRECTORIES "${dirs}")
ENDIF()
