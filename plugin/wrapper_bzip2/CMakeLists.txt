CHECK_INCLUDE_FILES(bzlib.h HAVE_BZLIB2_H)
CHECK_LIBRARY_EXISTS(bz2 BZ2_bzBuffToBuffCompress "" HAVE_BZLIB2_COMPRESS)
CHECK_LIBRARY_EXISTS(bz2 BZ2_bzBuffToBuffDecompress "" HAVE_BZLIB2_DECOMPRESS)

IF (HAVE_BZLIB2_H AND HAVE_BZLIB2_COMPRESS AND HAVE_BZLIB2_DECOMPRESS)
  GET_PROPERTY(dirs DIRECTORY PROPERTY INCLUDE_DIRECTORIES)
  LIST(REMOVE_ITEM dirs ${CMAKE_SOURCE_DIR}/include/wrappers)
  SET_PROPERTY(DIRECTORY PROPERTY INCLUDE_DIRECTORIES "${dirs}")

  MYSQL_ADD_PLUGIN(bzip2_plugin plugin.c MODULE_OUTPUT_NAME bzip2
    COMPONENT bzip2 LINK_LIBRARIES bz2 CONFIG bzip2.cnf)
ENDIF()
