CHECK_INCLUDE_FILES(snappy-c.h HAVE_SNAPPY_H)
CHECK_LIBRARY_EXISTS(snappy snappy_uncompress "" HAVE_SNAPPY_UNCOMPRESS)

IF (HAVE_SNAPPY_H AND HAVE_SNAPPY_UNCOMPRESS)
  GET_PROPERTY(dirs DIRECTORY PROPERTY INCLUDE_DIRECTORIES)
  LIST(REMOVE_ITEM dirs ${CMAKE_SOURCE_DIR}/include/wrappers)
  SET_PROPERTY(DIRECTORY PROPERTY INCLUDE_DIRECTORIES "${dirs}")

  MYSQL_ADD_PLUGIN(snappy_plugin plugin.c MODULE_OUTPUT_NAME snappy
    COMPONENT snappy LINK_LIBRARIES snappy CONFIG snappy.cnf)
ENDIF()
